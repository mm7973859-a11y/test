<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محل البتول للمنظفات</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main-red: #e63946; --dark: #1d3557; --white: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--white); padding-bottom: 80px; }
        
        /* الهيدر */
        header { background: var(--main-red); color: white; padding: 20px; text-align: center; position: relative; }
        
        /* زر تسجيل دخول الإدارة المطور */
        .admin-login-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            text-decoration: none;
        }

        .container { padding: 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 15px; padding: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .card img { width: 70px; height: 70px; margin-bottom: 10px; }
        .price { color: var(--main-red); font-weight: bold; font-size: 1.2em; margin: 5px 0; }
        .add-btn { background: var(--main-red); color: white; border: none; width: 100%; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        /* لوحة التحكم (المنبثقة) */
        #admin-panel { 
            display: none; 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: white; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 0 30px rgba(0,0,0,0.5); 
            z-index: 5000; 
            width: 85%; 
            max-width: 400px;
        }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        
        /* السلة السفلى */
        .cart-bar { position: fixed; bottom: 0; width: 100%; background: var(--dark); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 4000; display: none; padding: 20px; overflow-y: auto; box-sizing: border-box; }
    </style>
</head>
<body>

<header>
    <button class="admin-login-btn" onclick="loginAdmin()">Admin Login</button>
    
    <h1 style="margin:0;">محل البتول</h1>
    <p style="margin:5px 0; font-size:14px;">01030495245</p>
</header>

<div class="container" id="products-list">
    </div>

<div id="admin-panel">
    <h3 style="color:var(--main-red); margin-top:0; text-align:center;">إضافة منتج للمحل</h3>
    <input type="text" id="p-name" placeholder="اسم المنتج">
    <input type="number" id="p-price" placeholder="السعر">
    <button onclick="uploadProduct()" style="background:var(--main-red); color:white; border:none; padding:12px; width:100%; border-radius:8px; font-weight:bold; cursor:pointer;">نشر للمحل فوراً</button>
    <button onclick="document.getElementById('admin-panel').style.display='none'" style="background:#eee; border:none; margin-top:10px; width:100%; padding:8px; border-radius:8px; cursor:pointer;">إلغاء</button>
</div>

<div class="cart-bar" onclick="showCart()" style="cursor:pointer;">
    <span><i class="fas fa-shopping-basket"></i> السلة (<span id="cart-count">0</span>)</span>
    <span>إتمام الطلب <i class="fas fa-arrow-left"></i></span>
</div>

<div id="cart-modal" class="modal">
    <h2 style="color:var(--main-red)">مراجعة طلبك</h2>
    <div id="cart-items-display"></div>
    <h3 id="total-price" style="text-align: left; background: #fff1f2; padding: 10px; border-radius:8px;"></h3>
    <hr>
    <input type="text" id="u-name" placeholder="اسمك الكريم">
    <input type="tel" id="u-phone" placeholder="رقم الموبايل">
    <input type="text" id="u-address" placeholder="عنوان التوصيل">
    <select id="u-deliv" style="width:100%; padding:12px; margin:10px 0; border-radius:8px;">
        <option value="توصيل للمنزل">دليفري (توصيل للمنزل)</option>
        <option value="استلام من المحل">استلام من المحل</option>
    </select>
    <button onclick="sendToWhatsApp()" style="background:#25D366; color:white; border:none; padding:15px; width:100%; border-radius:10px; font-size:18px; font-weight:bold; cursor:pointer;">إرسال الطلب واتساب</button>
    <button onclick="closeCart()" style="width:100%; background:#eee; border:none; padding:10px; margin-top:10px; border-radius:8px; cursor:pointer;">العودة للمتجر</button>
</div>

<script>
    // ربط Firebase بمشروعك (testy)
    const firebaseConfig = {
        databaseURL: "https://testy-89b04-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let cart = [];

    // عرض المنتجات من القاعدة
    db.ref('products').on('value', (snapshot) => {
        const list = document.getElementById('products-list');
        list.innerHTML = "";
        snapshot.forEach((child) => {
            const p = child.val();
            list.innerHTML += `
                <div class="card">
                    <img src="https://img.icons8.com/fluency/96/cleaning-products.png">
                    <h4>${p.name}</h4>
                    <div class="price">${p.price} ج.م</div>
                    <button class="add-btn" onclick="addToCart('${p.name}', ${p.price})">أضف للسلة</button>
                </div>`;
        });
    });

    function loginAdmin() {
        const pass = prompt("أدخل كلمة مرور الإدارة:");
        if(pass === "1234") {
            document.getElementById('admin-panel').style.display = 'block';
        } else {
            alert("كلمة سر خاطئة!");
        }
    }

    function uploadProduct() {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        if(name && price) {
            db.ref('products').push({ name, price: parseInt(price) });
            alert("تمت الإضافة بنجاح!");
            document.getElementById('p-name').value = "";
            document.getElementById('p-price').value = "";
            document.getElementById('admin-panel').style.display = 'none';
        }
    }

    function addToCart(name, price) {
        cart.push({name, price});
        document.getElementById('cart-count').innerText = cart.length;
    }

    function showCart() {
        if(cart.length === 0) return alert("السلة فارغة");
        document.getElementById('cart-modal').style.display = 'block';
        const display = document.getElementById('cart-items-display');
        display.innerHTML = cart.map(i => `<div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee;"><span>${i.name}</span><span>${i.price} ج</span></div>`).join('');
        const total = cart.reduce((a, b) => a + b.price, 0);
        document.getElementById('total-price').innerText = "الإجمالي النهائي: " + total + " ج.م";
    }

    function closeCart() { document.getElementById('cart-modal').style.display = 'none'; }

    function sendToWhatsApp() {
        const name = document.getElementById('u-name').value;
        const phone = document.getElementById('u-phone').value;
        const addr = document.getElementById('u-address').value;
        const deliv = document.getElementById('u-deliv').value;

        if(!name || !phone) return alert("من فضلك أدخل الاسم ورقم الموبايل");

        let msg = `*طلب جديد من محل البتول*%0A*العميل:* ${name}%0A*الموبايل:* ${phone}%0A*العنوان:* ${addr}%0A*الاستلام:* ${deliv}%0A------------------%0A*الطلبات:*%0A`;
        cart.forEach((item, i) => msg += `${i+1}- ${item.name} (${item.price}ج)%0A`);
        msg += `------------------%0A*الإجمالي:* ${document.getElementById('total-price').innerText}`;
        
        window.open(`https://wa.me/201030495245?text=${msg}`);
    }
</script>
</body>
</html>
